{{ define "consolidated" }}
<section
    class="bg-white p-4 rounded-2xl shadow-xl border border-gray-100 sticky top-4 max-h-[90vh] overflow-y-auto custom-scroll">
    <div class="flex justify-between items-start mb-3">
        <h2 class="text-xl font-bold flex items-center gap-2">
            <span class="w-2 h-6 bg-orange-400 rounded-full"></span>
            Consolidado
        </h2>
        <div id="save-status"
            class="flex items-center gap-1.5 px-2 py-1 rounded-md bg-indigo-50 text-indigo-600 text-[9px] font-bold uppercase tracking-tighter border border-indigo-100 animate-pulse-soft">
            <svg class="w-3 h-3" fill="none" stroke="currentColor">
                <use href="/static/icons.svg#icon-clock" />
            </svg>
            </svg>
            Salvo
        </div>
    </div>

    <div id="total-equity-display" class="mb-4 text-center">
        <div class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Patrim√¥nio Total
        </div>
        <div id="total-value" class="text-4xl font-black text-indigo-800 transition-all duration-300">R$
            0,00</div>
        <div id="total-invested-global" class="text-[10px] font-medium text-gray-400 mt-1">Investido: R$
            0,00</div>

        <div id="total-return-global" class="flex justify-center items-center gap-1.5 text-xs font-bold mt-2">
            <!-- Injected by JS -->
        </div>
        <div id="global-risk-monitor"
            class="text-[9px] font-black uppercase mt-1.5 text-gray-400 tracking-tighter transition-all">
            Risco Global: --</div>
    </div>

    <div class="space-y-6">
        <div class="bg-gray-50/50 rounded-2xl p-3 border border-gray-100">
            <p class="text-[9px] font-black text-gray-400 uppercase mb-2 tracking-widest text-center">
                Distribui√ß√£o de Ativos</p>
            <div class="chart-container">
                <canvas id="allocationChart"></canvas>
            </div>
        </div>

        <div>
            <div class="flex-between mb-2 px-1">
                <span class="text-[9px] font-black text-gray-400 uppercase tracking-widest">Evolu√ß√£o</span>
                <div id="global-chart-filters" class="flex justify-end gap-1 items-center flex-wrap">
                    <button data-filter="1M"
                        class="filter-btn active text-[9px] font-bold text-gray-500 bg-white border border-gray-200 px-2 py-1 rounded hover:bg-gray-50 transition-colors">1M</button>
                    <button data-filter="2M"
                        class="filter-btn text-[9px] font-bold text-gray-500 bg-white border border-gray-200 px-2 py-1 rounded hover:bg-gray-50 transition-colors">2M</button>
                    <button data-filter="3M"
                        class="filter-btn text-[9px] font-bold text-gray-500 bg-white border border-gray-200 px-2 py-1 rounded hover:bg-gray-50 transition-colors">3M</button>
                    <button data-filter="6M"
                        class="filter-btn text-[9px] font-bold text-gray-500 bg-white border border-gray-200 px-2 py-1 rounded hover:bg-gray-50 transition-colors">6M</button>
                    <button data-filter="12M"
                        class="filter-btn text-[9px] font-bold text-gray-500 bg-white border border-gray-200 px-2 py-1 rounded hover:bg-gray-50 transition-colors">12M</button>
                    <button data-filter="YTD"
                        class="filter-btn text-[9px] font-bold text-gray-500 bg-white border border-gray-200 px-2 py-1 rounded hover:bg-gray-50 transition-colors">YTD</button>
                    <button data-filter="MAX"
                        class="filter-btn text-[9px] font-bold text-gray-500 bg-white border border-gray-200 px-2 py-1 rounded hover:bg-gray-50 transition-colors">M√°x</button>
                    <div class="w-px h-4 bg-gray-200 mx-1"></div>
                    <select id="global-year-select"
                        class="text-[9px] font-bold text-gray-500 bg-white border border-gray-200 px-1 py-1 rounded hover:bg-gray-50 transition-colors outline-none cursor-pointer">
                        <option value="">Ano</option>
                    </select>
                    <div class="w-px h-4 bg-gray-200 mx-1"></div>
                    <button id="global-custom-period-btn"
                        class="filter-btn text-[9px] font-bold text-gray-500 bg-white border border-gray-200 px-2 py-1 rounded hover:bg-gray-50 transition-colors"
                        title="Per√≠odo personalizado">üìÖ</button>
                </div>
                <div id="global-custom-period-inputs" class="hidden flex justify-end gap-1 items-center mt-1">
                    <input type="date" id="global-period-start"
                        class="text-[9px] font-bold text-gray-600 bg-white border border-gray-200 px-1 py-0.5 rounded outline-none">
                    <span class="text-gray-400 text-[9px]">at√©</span>
                    <input type="date" id="global-period-end"
                        class="text-[9px] font-bold text-gray-600 bg-white border border-gray-200 px-1 py-0.5 rounded outline-none">
                    <button id="global-apply-custom-period"
                        class="text-[9px] font-bold text-white bg-indigo-600 px-2 py-0.5 rounded hover:bg-indigo-700 transition-colors">OK</button>
                </div>
            </div>
            <div id="period-return-info" class="flex justify-between items-center text-[9px] font-bold mt-2 px-1 mb-1">
                <label
                    class="flex items-center gap-1 cursor-pointer text-gray-400 hover:text-gray-600 transition-colors">
                    <input type="checkbox" id="global-show-invested" unchecked
                        class="w-3 h-3 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer">
                    <span>Investido</span>
                </label>
                <div class="flex items-center gap-1">
                    <span class="text-gray-400">Retorno do Per√≠odo:</span>
                    <span id="period-return-value" class="text-indigo-600">--</span>
                </div>
            </div>
            <div class="history-chart-container">
                <canvas id="historyChart"></canvas>
            </div>
        </div>
    </div>

    <div class="mt-4 p-4 bg-indigo-50/30 rounded-2xl border border-indigo-100">
        <div class="flex justify-center items-center gap-1 mb-3">
            <p class="text-[9px] font-black text-gray-400 uppercase tracking-widest text-center">
                Proje√ß√£o (Atual)</p>
            <div class="group relative">
                <svg class="w-3 h-3 text-gray-300 cursor-help" fill="none" stroke="currentColor">
                    <use href="/static/icons.svg#icon-info" />
                </svg>
                </svg>
                <div
                    class="hidden group-hover:block absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-56 p-2 bg-gray-800 text-white text-[9px] rounded-lg shadow-lg z-50 normal-case font-medium leading-tight">
                    Estimativa de valor futuro baseada na performance passada dos seus ativos atuais.
                    <div
                        class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-800">
                    </div>
                </div>
            </div>
        </div>

        <!-- Headers -->
        <div class="grid grid-cols-2 gap-6 mb-3">
            <div class="text-center">
                <span class="text-[8px] font-black text-indigo-900 uppercase flex justify-center items-center gap-1">
                    Taxa Hist√≥rica (H)
                    <div class="group relative">
                        <svg class="w-2.5 h-2.5 text-indigo-300/70" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div
                            class="hidden group-hover:block absolute bottom-full left-1/2 -translate-x-1/2 mb-1 w-40 p-1.5 bg-gray-800 text-white text-[8px] rounded shadow-lg z-50 normal-case font-medium">
                            Baseada na rentabilidade total desde o primeiro aporte (M√©dia geom√©trica).
                        </div>
                    </div>
                </span>
                <div id="global-cur-first-speed" class="text-[7px] font-bold text-indigo-400 h-4">--</div>
            </div>
            <div class="text-center">
                <span class="text-[8px] font-bold text-indigo-400 uppercase flex justify-center items-center gap-1">
                    Momentum (R)
                    <div class="group relative">
                        <svg class="w-2.5 h-2.5 text-indigo-300/70" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div
                            class="hidden group-hover:block absolute bottom-full left-1/2 -translate-x-1/2 mb-1 w-40 p-1.5 bg-gray-800 text-white text-[8px] rounded shadow-lg z-50 normal-case font-medium">
                            Baseada na rentabilidade do √∫ltimo aporte (Tend√™ncia recente).
                        </div>
                    </div>
                </span>
                <div id="global-cur-last-speed" class="text-[7px] font-bold text-indigo-300 h-4">--</div>
            </div>
        </div>

        <!-- Data Rows -->
        <div class="space-y-2">
            <div class="grid grid-cols-2 gap-6">
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center border-r border-indigo-100 pr-3">
                    <span class="text-[10px] font-black text-indigo-950 text-right">6m:</span>
                    <span id="cur-first-6" class="text-[10px] font-black text-indigo-950 text-right">--</span>
                </div>
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center pl-3">
                    <span class="text-[9px] font-bold text-indigo-600 text-right">6m:</span>
                    <span id="cur-last-6" class="text-[9px] font-bold text-indigo-600 text-right">--</span>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-6">
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center border-r border-indigo-100 pr-3">
                    <span class="text-[10px] font-black text-indigo-950 text-right">12m:</span>
                    <span id="cur-first-12" class="text-[10px] font-black text-indigo-950 text-right">--</span>
                </div>
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center pl-3">
                    <span class="text-[9px] font-bold text-indigo-600 text-right">12m:</span>
                    <span id="cur-last-12" class="text-[9px] font-bold text-indigo-600 text-right">--</span>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-6">
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center border-r border-indigo-100 pr-3">
                    <span class="text-[10px] font-black text-indigo-950 text-right">24m:</span>
                    <span id="cur-first-24" class="text-[10px] font-black text-indigo-950 text-right">--</span>
                </div>
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center pl-3">
                    <span class="text-[9px] font-bold text-indigo-600 text-right">24m:</span>
                    <span id="cur-last-24" class="text-[9px] font-bold text-indigo-600 text-right">--</span>
                </div>
            </div>
            <!-- TTM Row -->
            <div class="grid grid-cols-2 gap-6 mt-2 pt-2 border-t border-indigo-100">
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center border-r border-indigo-100 pr-3">
                    <span class="text-[10px] font-black text-indigo-950 text-right">TTM:</span>
                    <span id="cur-first-ttm" class="text-[10px] font-black text-indigo-950 text-right">--</span>
                </div>
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center pl-3">
                    <span class="text-[9px] font-bold text-indigo-600 text-right">TTM:</span>
                    <span id="cur-last-ttm" class="text-[9px] font-bold text-indigo-600 text-right">--</span>
                </div>
            </div>
            <!-- TTM Benchmark Row -->
            <div class="flex justify-center items-center gap-2 mt-2 pt-2 border-t border-dashed border-indigo-100/50">
                <span class="text-[9px] font-bold text-gray-400">TTM Benchmark:</span>
                <span id="cur-benchmark-ttm" class="text-[9px] font-bold text-gray-500">--</span>
            </div>
        </div>
    </div>

    <div id="results-summary" class="mt-3"></div>
    <div id="action-plan" class="space-y-2 mt-3"></div>

    <div id="after-aporte-prognosis"
        class="mt-3 p-4 bg-indigo-900 rounded-2xl border border-indigo-800 shadow-lg text-white mb-2">
        <p class="text-[9px] font-black text-indigo-200 uppercase mb-3 tracking-widest text-center">
            Proje√ß√£o (P√≥s-Aporte)</p>
        <!-- Headers -->
        <div class="grid grid-cols-2 gap-6 mb-3">
            <div class="text-center">
                <span class="text-[8px] font-black uppercase text-indigo-300">Taxa Hist√≥rica</span>
                <div id="global-after-first-speed" class="text-[7px] font-bold text-indigo-400 h-4">--</div>
            </div>
            <div class="text-center">
                <span class="text-[8px] font-bold uppercase text-indigo-400">Momentum</span>
                <div id="global-after-last-speed" class="text-[7px] font-bold text-indigo-500 h-4">--</div>
            </div>
        </div>

        <!-- Data Rows -->
        <div class="space-y-2">
            <div class="grid grid-cols-2 gap-6">
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center border-r border-indigo-700/50 pr-3">
                    <span class="text-[10px] font-black text-white text-right">6m:</span>
                    <span id="after-first-6" class="text-[10px] font-black text-white text-right">--</span>
                </div>
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center pl-3">
                    <span class="text-[9px] font-bold text-indigo-100 text-right">6m:</span>
                    <span id="after-last-6" class="text-[9px] font-bold text-indigo-100 text-right">--</span>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-6">
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center border-r border-indigo-700/50 pr-3">
                    <span class="text-[10px] font-black text-white text-right">12m:</span>
                    <span id="after-first-12" class="text-[10px] font-black text-white text-right">--</span>
                </div>
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center pl-3">
                    <span class="text-[9px] font-bold text-indigo-100 text-right">12m:</span>
                    <span id="after-last-12" class="text-[9px] font-bold text-indigo-100 text-right">--</span>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-6">
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center border-r border-indigo-700/50 pr-3">
                    <span class="text-[10px] font-black text-white text-right">24m:</span>
                    <span id="after-first-24" class="text-[10px] font-black text-white text-right">--</span>
                </div>
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center pl-3">
                    <span class="text-[9px] font-bold text-indigo-100 text-right">24m:</span>
                    <span id="after-last-24" class="text-[9px] font-bold text-indigo-100 text-right">--</span>
                </div>
            </div>
            <!-- TTM Row -->
            <div class="grid grid-cols-2 gap-6 mt-2 pt-2 border-t border-indigo-700/50">
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center border-r border-indigo-700/50 pr-3">
                    <span class="text-[10px] font-black text-white text-right">TTM:</span>
                    <span id="after-first-ttm" class="text-[10px] font-black text-white text-right">--</span>
                </div>
                <div class="grid grid-cols-[auto_1fr] gap-2 items-center pl-3">
                    <span class="text-[9px] font-bold text-indigo-100 text-right">TTM:</span>
                    <span id="after-last-ttm" class="text-[9px] font-bold text-indigo-100 text-right">--</span>
                </div>
            </div>
        </div>
    </div>
</section>
{{ end }}